<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<script src='angular/angular.js'></script>
	<style>
		.container {width: 400px; padding: 20px; background: #eee; margin: 0 auto; border-radius: 5px;}
		ul {padding-left: 0;}
		li {list-style-type: none;}
		.done-true {color: #999; text-decoration: line-through;}
	</style>
</head>
<body ng-app='myApp' ng-controller='myCtrl'>
	
	<div class="container">
		<h2>任务列表</h2>
		<span>任务总数：{{ todos.length }}；还有：{{ remaining() }}未完成；</span>&nbsp;&nbsp;[<a href="#" ng-click='archive()'>完成</a>]

		<ul>
			<li ng-repeat='item in todos'>
				<input type="checkbox" ng-model='item.done'>
				<span ng-show='item.showing' ng-click='changeFlag($index)' class='done-{{item.done}}' title='{{ item.warning }}' ng-mouseover='warning($index)'>{{ item.text }}</span>
				<input type="text" ng-model='item.text' ng-show='!item.showing' ng-blur='changeFlag($index)'>
			</li>
			
		</ul>

		<form ng-submit='addTodo()'>
			<input type="text" ng-model='todoText'>
			<button>添加</button>
		</form>
	</div>
	

</body>
</html>
<script>
	var app = angular.module('myApp', []);

	app.controller('myCtrl', function ($scope) {
		$scope.todos = [
			{'text':'coding', 'done':false, 'showing':true, 'warning':''},
			{'text':'切图', 'done':false, 'showing':true, 'warning':''},
			{'text':'搬砖', 'done':false, 'showing':true, 'warning':''},
		];

		$scope.addTodo = function () {
			// body...
			$scope.todos.push(
				{'text': $scope.todoText, 'done': false, 'showing':true}
			);

			$scope.todoText = '';
		}

		$scope.remaining = function () {
			// body...
			var count = 0;

			$scope.todos.forEach(function (ele) {
				// body...
				count += ele.done?0:1;
			});

			return count;
		}

		$scope.archive = function () {
			// body...
			$scope.todos = $scope.todos.filter(function (ele) {
				// body...
				return !ele.done
			});

			// filter(function(ele){ele:每次遍历数组后得到的元素})
		}

		$scope.changeFlag = function (index) {
			console.log(1);
			// body...
			// 如果任意已完成，不能进行更改
			if (!$scope.todos[index].done){
				// 将选中的任务状态，进行更改
				// 其他的任务都改成span
				$scope.todos.forEach(function (ele,i) {
					// body...
					if (i != index) ele.showing = true;
				});

				// 取反
				$scope.todos[index].showing = !$scope.todos[index].showing;
			}
		}

		$scope.warning = function (index) {
			// body...
			// 鼠标移入，如果该条任务已完成，那么更改warnig值
			if ($scope.todos[index].done){
				$scope.todos[index].warning = '已经完成的任务不能修改';
			}else{
				$scope.todos[index].warning = '';
			}
		}
	});

</script>