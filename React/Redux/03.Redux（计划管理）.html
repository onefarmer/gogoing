<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
<script>
    // 封装 这个状态管理器只能管理
    const createStore = function(plan,initState){
        let state = initState;
        let listeners = [];    
        /* 订阅 */
        function subscribe(listener){
            listeners.push(listener)
        }    
        // 状态改变 之前传递新数据 这次直接传递动作，附带类型
        function changeState(action){
            /* 请按照我的计划修改state */  
            state = plan(state,action);
            /* 通知 */
            for( let i=0; i<listeners.length;i++){
                const listener = listeners[i];
                listener()
            }
        }
        // 状态返回
        function getState(){
            //console.log(state)
            return state;
        }
        return {
            subscribe,
            changeState,
            getState
        }
    }
    // 管理器来实现一个自增，自减的计数器。
    let initState = {
        count:0
    }
    let store = createStore(plan,initState);
    // 读取状态
    store.subscribe(()=>{
        let state = store.getState();
        console.log( state.count )
    })
    // 设置一个 plan 函数，接收现在的 state，和一个 action，返回经过改变后的新的 state。
    /* 注意：action = {type:'',other:''}, action 必须有一个 type 属性 */

    // state 旧数据 action 动作附带限制类型
    function plan(state,action){
        switch(action.type){
            // 增
            case 'INCREMENT':{
                return {
                    ...state,
                    count:state.count + 100
                }
            }
            // 减
            case 'DECREMENT':{
                return {
                    ...state,
                    count:state.count - 1
                }
            }
            default:
            return state;
        }
    }
    /* 自增 */
    store.changeState({
        type: 'INCREMENT'
    });
    /* 自减 */
    store.changeState({
        type: 'DECREMENT'
    });
    /* 随意类型 计划外的修改是无效的！*/
    store.changeState({
        count: 'abc'
    });

</script>
</body>
</html>